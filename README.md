# Switch Game Repository ğŸ®

A modern community platform for managing and distributing Nintendo Switch game files (.nsp, .nsz, .xci) with user authentication, role-based access control, and API key management.

## âœ¨ Features

- ğŸ” **Real-time Search** - Client-side filtering with instant results
- ğŸ‘¥ **User System** - Registration, authentication, and role-based permissions (Admin/Mod/Uploader/User)
- ğŸ”‘ **API Keys** - Generate and manage API keys for programmatic access
- ğŸ“Š **Admin Dashboard** - Directory management, user control, audit logs, and statistics
- ğŸ¯ **Request System** - Users can request games, mods approve/reject
- ğŸ“ **Multi-format Support** - NSP, NSZ, and XCI file types
- ğŸŒ **Flexible Sources** - Local filepaths or external URLs
- ğŸ¨ **Modern UI** - Dark theme with smooth transitions

## ğŸ› ï¸ Tech Stack

- **Backend**: Starlette (async Python)
- **Database**: ArangoDB
- **Frontend**: HTML, JavaScript, CSS
- **Configuration**: YAML-based (`config.yaml`)

## ğŸ“‹ Requirements

- Python 3.10+
- ArangoDB 3.x+

## ğŸš€ Quick Start

### 1. Clone the repository

```bash
git clone https://github.com/obnoxiousmods/switch.git
cd switch
```

### 2. Install Python dependencies

```bash
pip install -r requirements.txt
```

### 3. Set up ArangoDB

Download and install from [arangodb.com/download](https://www.arangodb.com/download/)

Start the service:
```bash
# Linux/macOS
sudo systemctl start arangodb3

# Or manually
arangod
```

### 4. Run the application

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**Or use the provided launch scripts:**
- Windows: `launch.bat`
- Linux/macOS: `./launch.sh`

### 5. Initialize via web interface

ğŸŒ Open your browser and navigate to:

```
http://localhost:8000/admincp/init
```

Complete the setup form with:
- **Website Name** - Your site's display name
- **Admin Username** - Your admin login username
- **Admin Password** - Secure password for admin account
- **Database Settings** - ArangoDB connection details:
  - Host: `localhost` (default)
  - Port: `8529` (default)
  - Username: `root` (default)
  - Password: Your ArangoDB password
  - Database Name: `switch_db` (or custom)

The system will automatically:
- âœ… Create `config.yaml` with your settings
- âœ… Connect to ArangoDB and create the database
- âœ… Create your admin account
- âœ… Add sample game entries for testing
- âœ… Redirect you to the homepage

## ğŸ“ Project Structure

```
switch/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ main.py                # Application entry point
â”‚   â”œâ”€â”€ config.py              # Config management (loads config.yaml)
â”‚   â”œâ”€â”€ config.yaml            # Generated by web init (git ignored)
â”‚   â”œâ”€â”€ database.py            # ArangoDB connection
â”‚   â”œâ”€â”€ routes/                # Route handlers
â”‚   â”‚   â”œâ”€â”€ api.py            # Public API endpoints
â”‚   â”‚   â”œâ”€â”€ pages.py          # Page routes
â”‚   â”‚   â”œâ”€â”€ auth.py           # Authentication
â”‚   â”‚   â”œâ”€â”€ admin.py          # Admin panel
â”‚   â”‚   â”œâ”€â”€ mod.py            # Moderator panel
â”‚   â”‚   â”œâ”€â”€ uploader.py       # Uploader panel
â”‚   â”‚   â””â”€â”€ api_keys.py       # API key management
â”‚   â”œâ”€â”€ models/               # Data models
â”‚   â”œâ”€â”€ templates/            # HTML templates
â”‚   â””â”€â”€ middleware/           # Custom middleware
â”œâ”€â”€ static/                   # CSS, JS, assets
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ launch.bat                # Windows launcher
â””â”€â”€ launch.sh                 # Unix launcher
```

## ğŸ” User Roles

| Role | Permissions |
|------|-------------|
| **Admin** | Full system access, user management, directory scanning, settings |
| **Moderator** | Approve/reject requests, moderate users, view audit logs |
| **Uploader** | Upload games, manage own uploads, view upload stats |
| **User** | Browse, search, download, request games |

## ğŸ”Œ API Endpoints

### Public Endpoints

```
GET  /api/list                    # List all game entries
GET  /api/download/{entry_id}     # Download game file
GET  /api-docs                    # API documentation
```

### Authenticated Endpoints

Include API key in request header:
```
X-API-Key: your_api_key_here
```

**Generate API keys:**
1. Log in to your account
2. Navigate to Settings â†’ API Keys
3. Create a new key with a descriptive name
4. Copy the key immediately (shown only once!)

## ğŸ—„ï¸ Database Schema

**Entries Collection**:
```json
{
  "_key": "auto-generated",
  "name": "Game Title",
  "source": "/path/to/file.nsp",
  "type": "filepath",
  "file_type": "nsp",
  "size": 5800000000,
  "created_at": "2026-02-13T12:00:00Z",
  "created_by": "admin",
  "metadata": {
    "description": "Game description",
    "version": "1.0.0",
    "publisher": "Nintendo",
    "release_date": "2024-01-01"
  }
}
```

## âš™ï¸ Configuration

Configuration is stored in `app/config.yaml` (auto-generated during initialization).

**Example structure:**
```yaml
initialized: true
app:
  name: Switch Game Repository
  debug: true
database:
  host: localhost
  port: 8529
  username: root
  password: your_password
  database: switch_db
security:
  secret_key: auto-generated-secret-key
```

> **Note**: `config.yaml` is gitignored and should never be committed.

## ğŸ”§ Development

### Running in development mode

```bash
uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

The `--reload` flag enables auto-restart on code changes.

### Logs

The application uses Python's logging module. Logs are output to stdout.

## ğŸ¯ Usage Guide

### Admin Tasks

1. **Add scan directories** - Admin CP â†’ Directory Management
2. **Scan for games** - Triggers automatic game detection
3. **Manage users** - View, edit roles, force password changes
4. **View audit logs** - Track all system actions

### User Workflow

1. **Register account** - `/register`
2. **Browse games** - Search and filter on homepage
3. **Request games** - Submit requests for missing titles
4. **Generate API key** - For programmatic access

## ğŸš¨ Troubleshooting

**"System not initialized" error:**
- Visit `/admincp/init` to complete setup

**Database connection failed:**
- Ensure ArangoDB is running (`systemctl status arangodb3`)
- Verify credentials in initialization form
- Check firewall settings (port 8529)

**Port already in use:**
```bash
# Change port in launch command
uvicorn app.main:app --host 0.0.0.0 --port 8080
```

## ğŸ“ License

GNU General Public License v3.0 - See LICENSE file for details.

## ğŸ¤ Contributing

Contributions are welcome! Please feel free to submit a Pull Request.

## ğŸ› Support

For issues and questions, use the [GitHub issue tracker](https://github.com/obnoxiousmods/switch/issues).

---

**âš ï¸ Disclaimer**: This tool is intended for managing legally obtained backup files. Always respect copyright laws in your jurisdiction.